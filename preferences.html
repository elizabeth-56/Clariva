<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Typography Preference Manager</title>
    <style>
        :root {
            /* Variables updated by JS */
            --bg-color: #f5f5dc; /* beige */
            --text-color: #000000;
            --font-family: 'Arial';
            --font-size: 16px;
            --line-height: 1.5;
            --letter-spacing: 1.6px;
            --word-spacing: 3.2px;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Preference Sidebar */
        #pref-sidebar {
            width: 350px;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.2);
            overflow-y: auto;
            z-index: 100;
        }

        h2 { border-bottom: 2px solid #34495e; padding-bottom: 10px; margin-top: 0; }

        .control-group { margin-bottom: 20px; }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-size: 0.85rem; 
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #bdc3c7;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            background: #34495e;
            color: white;
            border: 1px solid #455a64;
            border-radius: 4px;
        }

        .value-display {
            float: right;
            color: #1abc9c;
            font-weight: bold;
        }

        /* Preview Area */
        #main-preview {
            flex-grow: 1;
            padding: 60px;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-y: auto;
            transition: background 0.3s, color 0.3s;
        }

        .text-container {
            max-width: 750px;
            margin: 0 auto;
            /* Applying the dynamic styles */
            font-family: var(--font-family);
            font-size: var(--font-size);
            line-height: var(--line-height);
            letter-spacing: var(--letter-spacing);
            word-spacing: var(--word-spacing);
            text-align: left;
        }
    </style>
</head>
<body>

    <aside id="pref-sidebar">
        <h2>Preferences</h2>
        <div id="controls-root">
            </div>
    </aside>

    <main id="main-preview">
        <article class="text-container">
            <h1>Accessibility Preview</h1>
            <p>This text updates in real-time as you adjust the preferences in the sidebar. The ranges for font size and line spacing are pulled directly from your JSON dataset.</p>
            <p>Letter spacing and word spacing are currently calculated as percentages of the font size (10% and 20% respectively) to maintain visual harmony as you scale the text up or down.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </article>
    </main>

<script>
    async function loadPreferences() {
        try {
            const response = await fetch('preference.json');
            const data = await response.json();
            buildUI(data);
        } catch (e) {
            console.error("Fetch error. Make sure preference.json exists and you are using a local server.", e);
            document.getElementById('controls-root').innerHTML = "Error loading preference.json";
        }
    }

    function buildUI(data) {
        const root = document.getElementById('controls-root');
        root.innerHTML = ''; 

        // 1. Font Family
        addDropdown(root, "Font Family", data.font_family, (v) => updateVar('--font-family', v));

        // 2. Background Color
        addDropdown(root, "Background", data.background_color, (v) => updateVar('--bg-color', v));

        // 3. Foreground Color
        addDropdown(root, "Text Color", data.forground_color, (v) => updateVar('--text-color', v.replace('dark-', '')));

        // 4. Font Size (Min/Max/Recommended)
        addSlider(root, "Font Size", data.font_size.min, data.font_size.max, data.font_size.recommended, "px", (v) => {
            updateVar('--font-size', v + 'px');
            // Recalculate relative spacings when font size changes
            updateRelativeSpacings(v, data.letter_spacing.recommended_percent, data.word_spacing.recommended_percent);
        });

        // 5. Line Spacing (Min/Max/Recommended)
        addSlider(root, "Line Spacing", data.line_spacing.min, data.line_spacing.max, data.line_spacing.recommended, "", (v) => {
            updateVar('--line-height', v);
        }, 0.1);

        // Initial application of spacing logic
        updateRelativeSpacings(data.font_size.recommended, data.letter_spacing.recommended_percent, data.word_spacing.recommended_percent);
        updateVar('--line-height', data.line_spacing.recommended);
    }

    function updateVar(name, val) {
        document.documentElement.style.setProperty(name, val);
    }

    function updateRelativeSpacings(fontSize, letPct, wordPct) {
        const lSpc = (fontSize * letPct) / 100;
        const wSpc = (fontSize * wordPct) / 100;
        updateVar('--letter-spacing', lSpc + 'px');
        updateVar('--word-spacing', wSpc + 'px');
    }

    function addDropdown(parent, label, options, callback) {
        const group = document.createElement('div');
        group.className = 'control-group';
        group.innerHTML = `<label>${label}</label>`;
        const sel = document.createElement('select');
        options.forEach(opt => {
            const o = document.createElement('option');
            o.value = opt; o.textContent = opt;
            sel.appendChild(o);
        });
        sel.onchange = (e) => callback(e.target.value);
        group.appendChild(sel);
        parent.appendChild(group);
    }

    function addSlider(parent, label, min, max, initial, unit, callback, step = 1) {
        const group = document.createElement('div');
        group.className = 'control-group';
        group.innerHTML = `
            <label>${label} <span class="value-display" id="val-${label}">${initial}${unit}</span></label>
            <input type="range" min="${min}" max="${max}" step="${step}" value="${initial}">
        `;
        const input = group.querySelector('input');
        input.oninput = (e) => {
            document.getElementById(`val-${label}`).textContent = e.target.value + unit;
            callback(e.target.value);
        };
        parent.appendChild(group);
    }

    loadPreferences();
</script>
</body>
</html>